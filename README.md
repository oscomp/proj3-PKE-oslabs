# proj3-PKE-oslabs

## 基于代理内核PKE的操作系统实验设计

----------


## 项目描述 ##

当前大学本科学生做操作系统课程实验面临的做内核难度高、工作量大；做一些应用的设计又导致难度太低，对操作系统理解不透彻等问题。为此，我们希望设计一组面向普通大学本科生的操作系统实验。 这个实验的目标是，将操作系统的**知识点进行分解，先找到合适的（利用到操作系统知识点所支持的）应用，完成代理内核（即一个“刚刚好”的内核）的设计，并最终将应用在RISC-V的模拟环境（我们倾向于使用Spike）上运行起来**。这一组操作系统实验的设计特点是：**以典型应用驱动，带动内核的开发，随着应用的不断复杂化，最终获得一个功能较为完善的操作系统**。

为此，我们采用了如下的规划思路：

- 在目标机方面，我们选择了支持RV64G指令集的RISC-V机器，为了方便部署和调试，我们推荐使用Spike模拟器，实验尽量利用Spike模拟器所提供的HTIF（Host-Target InterFace）来屏蔽底层硬件的具体操纵细节，将实验环节的设计重点放在操作系统的核心概念（如虚实转换、资源管理与调度）的实现上。考虑到PKE实验项目的重点是应用驱动内核开发，参赛作品对目标机的选择并不局限于Spike，也可以采用QEMU，只要遵从应用驱动内核开发的思想，实验设计能够体现操作系统的核心内容（而不是放在某某硬件的具体操纵上）即可。
- 在软件编程语言方面，我们推荐使用C语言和RISC-V汇编语言，保证PKE实验的一致性。
- 在设计内容上，我们鼓励在PKE现有实验基础上的**增量内容**。如现有实验的挑战（进阶）版本，文件系统实验、设备管理实验等。


PKE现有的文档和源码：  
- （文档）：https://gitee.com/syivester/pke-doc
- （代码）：https://github.com/MrShawCode/pke

## 所属赛道 ##

2021全国大学生操作系统比赛的“OS功能设计”赛道

## 参赛要求 ##

- 以小组为单位参赛，最多3人一个小组，且小组成员是来自同一所高校的本科生（2021年春季学期或之后本科毕业的大一~大四的学生）
- 如学生参加了多个项目，参赛学生选择一个自己参加的项目参与评奖
- 请遵循“2021全国大学生操作系统比赛”的章程和技术方案要求

## 项目导师 ##

邵志远

- email: zyshao@hust.edu.cn

## 难度 ##

初等~中等

## 特征 ##

- 采用软件模拟器，如Spike或QEMU，模拟支持RV64G指令集的RISC-V目标机器（不鼓励物理机器）
- 使用C语言/内嵌RISC-V汇编实现
- 为进一步阅读/修改类UNIX操作系统，如xv6、UCore、Linux内核等，打下基础
- 可参考其他教学类操作系统（如JOS/UCore/xv6等）的实现，但要作品要体现与所参考的系统的不同

## 参考文档 ##

- https://gitee.com/syivester/pke-doc
- 请认真阅读参考文档，里面的实验文档可以作为作品的例子。

### License ###

GPL-3 license

## 预期目标 ##

**所提交的作品应至少包括以下内容**：

- **输入应用**（最好找到贴合实际，且具有代表性的应用）
- **设计任务**（对实验所要达到的目标有较为准确、详细的描述）
- **帮助文档**（要求尽量详细，能够引导读者的理解，符合普通高校本科生的知识储备）

**注意：下面的内容是建议内容，不要求必须全部完成。选择本项目的同学也可与导师联系，提出自己的新想法，如导师认可，可加入预期目标**


在现有PKE课程实验的基础上，进一步完成如下目标：

### 第一题：现有实验的挑战内容 ###

- PKE已有一些实验，包括非法指令截获、系统调用、物理内存管理、缺页异常的处理、进程的封装、多进程支持、信号量的实现等。
- 新增实验可以考虑设计这些实验环节的挑战部分，例如在非法指令截获的基础上，实现对应用中使用到了非法指令的代码行进行报告等。

### 第二题：文件系统支持 ###

- Spike模拟器提供了HTIF，目标环境下运行的应用实际上是可以“穿透”访问主机上的文件的。同时，由于HTIF的存在，对设备的访问被极大简化。
- PKE实验中的文件系统需要另辟蹊径！作品的设计，应重点考虑文件系统的核心价值：在对数据访问上，实现逻辑到物理的转换，以及按名存取的核心功能。
- 一些可能的思路：1）类似chroot或docker，把主机上的一个子目录当作目标机的根目录来管理，并实现一些操作系统的概念，如树形目录、文件链接等。
2）类似QEMU那样，将一个文件作为虚拟硬盘，开发一整套文件系统（包括文件物理结构、文件目录等等）。

### 第三题：设备管理 ###

- 应用应实现对设备的访问，例如访问主机上的声卡播放音乐、通过主机上的网卡进行网络通讯等。
- 实验设计环节可以考虑基于/不基于文件系统支持，需要将主机上的设备用抽象硬件表达，实验重点考虑虚拟设备到抽象硬件的转换。
- 实验的设计并体现操作系统的基础概念，如设备独立性、设备虚拟分配等。


